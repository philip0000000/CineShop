@model CineShop.Models.Order

@{
    ViewData["Title"] = "Order Details";
    Layout = "~/Views/Shared/_Layout.cshtml";

    decimal totalPrice = Model.OrderRows?.Sum(row => row.Price) ?? 0;
}

<div class="container py-5">
    <h1 class="text-warning text-center fw-bold mb-4">
        <i class="fa-solid fa-receipt me-2"></i> Order Details
    </h1>
    <p class="lead text-light text-center mb-4">
        A complete summary of this order, including customer info and selected movies.
    </p>

    <div class="card bg-dark text-light border-warning shadow-sm mx-auto" style="max-width: 900px;">
        <div class="card-body">
            <h5 class="text-warning fw-bold mb-3">Order Info</h5>
            <dl class="row">
                <dt class="col-sm-4 text-muted">Order ID</dt>
                <dd class="col-sm-8">@Model.Id</dd>

                <dt class="col-sm-4 text-muted">Order Date</dt>
                <dd class="col-sm-8">@Model.OrderDate.ToString("yyyy-MM-dd")</dd>

                <dt class="col-sm-4 text-muted">Customer</dt>
                <dd class="col-sm-8">@Model.Customer.FirstName @Model.Customer.LastName</dd>

                <dt class="col-sm-4 text-muted">Email</dt>
                <dd class="col-sm-8">@Model.Customer.EmailAddress</dd>
            </dl>

            <hr class="border-warning" />

            <h5 class="text-warning fw-bold mb-3">Ordered Movies</h5>
            @if (Model.OrderRows != null && Model.OrderRows.Any())
            {
                <table class="table table-dark table-bordered border-warning align-middle">
                    <thead class="table-warning text-dark">
                        <tr>
                            <th>Title</th>
                            <th>Genre</th>
                            <th>Director</th>
                            <th>Release Year</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var row in Model.OrderRows)
                        {
                            var movie = row.Movie;
                            <tr>
                                <td>@movie?.Title</td>
                                <td>@movie?.Genre</td>
                                <td>@movie?.Director</td>
                                <td>@movie?.ReleaseYear</td>
                                <td class="text-success fw-semibold">@row.Price.ToString("C")</td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4" class="text-end fw-bold">Total:</td>
                            <td class="text-success fw-bold">@totalPrice.ToString("C")</td>
                        </tr>
                    </tfoot>
                </table>
            }
            else
            {
                <p class="text-muted">No movies found in this order.</p>
            }
        </div>

        <!-- back button -->
        <div class="text-center mt-4 pb-3">
            <a asp-action="Orders" asp-controller="Admin"
               class="btn btn-outline-warning px-4 fw-semibold shadow-sm">
                <i class="fa fa-arrow-left me-2"></i> Back to Orders
            </a>
        </div>

    </div>
</div>
